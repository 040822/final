=== 英中翻译模型训练 ===
✓ 环境变量设置完成
🚀 加载数据集...
✓ 训练集加载完成，耗时: 0.80 秒
✓ 数据集分割完成
训练集大小: 495000
测试集大小: 5000

==================================================
训练Qwen模型
==================================================
🔧 初始化Qwen模型: Qwen/Qwen2.5-0.5B
✓ 模型初始化完成
词汇表大小: 151665
🔄 加载已缓存的预处理数据...
✓ 数据预处理完成
🚀 开始训练Qwen模型...
  0%|          | 0/247 [00:00<?, ?it/s]`use_cache=True` is incompatible with gradient checkpointing. Setting `use_cache=False`.
  0%|          | 1/247 [00:01<04:15,  1.04s/it]  1%|          | 2/247 [00:01<02:08,  1.91it/s]  1%|          | 3/247 [00:01<01:28,  2.75it/s]  2%|▏         | 4/247 [00:01<01:10,  3.45it/s]  2%|▏         | 5/247 [00:01<01:00,  4.03it/s]  2%|▏         | 6/247 [00:01<00:54,  4.39it/s]  3%|▎         | 7/247 [00:02<00:50,  4.76it/s]  3%|▎         | 8/247 [00:02<00:47,  5.01it/s]  4%|▎         | 9/247 [00:02<00:45,  5.22it/s]  4%|▍         | 10/247 [00:02<00:44,  5.37it/s]  4%|▍         | 11/247 [00:02<00:42,  5.49it/s]  5%|▍         | 12/247 [00:02<00:42,  5.58it/s]  5%|▌         | 13/247 [00:03<00:41,  5.63it/s]  6%|▌         | 14/247 [00:03<00:41,  5.65it/s]  6%|▌         | 15/247 [00:03<00:43,  5.34it/s]  6%|▋         | 16/247 [00:03<00:42,  5.45it/s]  7%|▋         | 17/247 [00:03<00:41,  5.54it/s]  7%|▋         | 18/247 [00:04<00:41,  5.52it/s]  8%|▊         | 19/247 [00:04<00:40,  5.62it/s]  8%|▊         | 20/247 [00:04<00:40,  5.64it/s]  9%|▊         | 21/247 [00:04<00:39,  5.68it/s]  9%|▉         | 22/247 [00:04<00:39,  5.71it/s]  9%|▉         | 23/247 [00:04<00:39,  5.70it/s] 10%|▉         | 24/247 [00:05<00:38,  5.73it/s] 10%|█         | 25/247 [00:05<00:38,  5.75it/s] 11%|█         | 26/247 [00:05<00:38,  5.76it/s] 11%|█         | 27/247 [00:05<00:38,  5.78it/s] 11%|█▏        | 28/247 [00:05<00:38,  5.74it/s] 12%|█▏        | 29/247 [00:05<00:37,  5.77it/s] 12%|█▏        | 30/247 [00:06<00:37,  5.78it/s] 13%|█▎        | 31/247 [00:06<00:37,  5.76it/s] 13%|█▎        | 32/247 [00:06<00:37,  5.72it/s] 13%|█▎        | 33/247 [00:06<00:37,  5.70it/s] 14%|█▍        | 34/247 [00:06<00:37,  5.71it/s] 14%|█▍        | 35/247 [00:07<00:36,  5.74it/s] 15%|█▍        | 36/247 [00:07<00:36,  5.77it/s] 15%|█▍        | 37/247 [00:07<00:36,  5.75it/s] 15%|█▌        | 38/247 [00:07<00:36,  5.76it/s] 16%|█▌        | 39/247 [00:07<00:36,  5.78it/s] 16%|█▌        | 40/247 [00:07<00:35,  5.78it/s] 17%|█▋        | 41/247 [00:08<00:35,  5.77it/s] 17%|█▋        | 42/247 [00:08<00:35,  5.78it/s] 17%|█▋        | 43/247 [00:08<00:36,  5.55it/s] 18%|█▊        | 44/247 [00:08<00:36,  5.64it/s] 18%|█▊        | 45/247 [00:08<00:35,  5.69it/s] 19%|█▊        | 46/247 [00:08<00:35,  5.66it/s] 19%|█▉        | 47/247 [00:09<00:35,  5.70it/s] 19%|█▉        | 48/247 [00:09<00:34,  5.71it/s] 20%|█▉        | 49/247 [00:09<00:34,  5.73it/s] 20%|██        | 50/247 [00:09<00:34,  5.72it/s] 21%|██        | 51/247 [00:09<00:34,  5.75it/s] 21%|██        | 52/247 [00:09<00:33,  5.77it/s] 21%|██▏       | 53/247 [00:10<00:33,  5.75it/s] 22%|██▏       | 54/247 [00:10<00:33,  5.77it/s] 22%|██▏       | 55/247 [00:10<00:33,  5.77it/s] 23%|██▎       | 56/247 [00:10<00:33,  5.73it/s] 23%|██▎       | 57/247 [00:10<00:33,  5.74it/s] 23%|██▎       | 58/247 [00:11<00:33,  5.72it/s] 24%|██▍       | 59/247 [00:11<00:32,  5.75it/s] 24%|██▍       | 60/247 [00:11<00:32,  5.76it/s] 25%|██▍       | 61/247 [00:11<00:32,  5.74it/s] 25%|██▌       | 62/247 [00:11<00:32,  5.72it/s] 26%|██▌       | 63/247 [00:11<00:32,  5.74it/s] 26%|██▌       | 64/247 [00:12<00:31,  5.77it/s] 26%|██▋       | 65/247 [00:12<00:31,  5.74it/s] 27%|██▋       | 66/247 [00:12<00:31,  5.74it/s] 27%|██▋       | 67/247 [00:12<00:31,  5.75it/s] 28%|██▊       | 68/247 [00:12<00:31,  5.71it/s] 28%|██▊       | 69/247 [00:12<00:31,  5.69it/s] 28%|██▊       | 70/247 [00:13<00:30,  5.72it/s] 29%|██▊       | 71/247 [00:13<00:30,  5.74it/s] 29%|██▉       | 72/247 [00:13<00:30,  5.74it/s] 30%|██▉       | 73/247 [00:13<00:30,  5.70it/s] 30%|██▉       | 74/247 [00:13<00:30,  5.68it/s] 30%|███       | 75/247 [00:13<00:30,  5.71it/s] 31%|███       | 76/247 [00:14<00:29,  5.73it/s] 31%|███       | 77/247 [00:14<00:29,  5.76it/s] 32%|███▏      | 78/247 [00:14<00:29,  5.75it/s] 32%|███▏      | 79/247 [00:14<00:29,  5.78it/s] 32%|███▏      | 80/247 [00:14<00:29,  5.75it/s] 33%|███▎      | 81/247 [00:15<00:28,  5.78it/s] 33%|███▎      | 82/247 [00:15<00:28,  5.78it/s] 34%|███▎      | 83/247 [00:15<00:28,  5.78it/s] 34%|███▍      | 84/247 [00:15<00:28,  5.77it/s] 34%|███▍      | 85/247 [00:15<00:28,  5.75it/s] 35%|███▍      | 86/247 [00:15<00:27,  5.76it/s] 35%|███▌      | 87/247 [00:16<00:27,  5.75it/s] 36%|███▌      | 88/247 [00:16<00:27,  5.75it/s] 36%|███▌      | 89/247 [00:16<00:27,  5.76it/s] 36%|███▋      | 90/247 [00:16<00:27,  5.72it/s] 37%|███▋      | 91/247 [00:16<00:27,  5.74it/s] 37%|███▋      | 92/247 [00:16<00:27,  5.73it/s] 38%|███▊      | 93/247 [00:17<00:26,  5.75it/s] 38%|███▊      | 94/247 [00:17<00:26,  5.75it/s] 38%|███▊      | 95/247 [00:17<00:26,  5.71it/s] 39%|███▉      | 96/247 [00:17<00:26,  5.62it/s] 39%|███▉      | 97/247 [00:17<00:26,  5.65it/s] 40%|███▉      | 98/247 [00:18<00:26,  5.66it/s] 40%|████      | 99/247 [00:18<00:26,  5.69it/s] 40%|████      | 100/247 [00:18<00:25,  5.70it/s] 41%|████      | 101/247 [00:18<00:25,  5.69it/s] 41%|████▏     | 102/247 [00:18<00:25,  5.72it/s] 42%|████▏     | 103/247 [00:18<00:25,  5.68it/s] 42%|████▏     | 104/247 [00:19<00:25,  5.67it/s] 43%|████▎     | 105/247 [00:19<00:24,  5.68it/s] 43%|████▎     | 106/247 [00:19<00:24,  5.68it/s] 43%|████▎     | 107/247 [00:19<00:24,  5.69it/s] 44%|████▎     | 108/247 [00:19<00:24,  5.72it/s] 44%|████▍     | 109/247 [00:19<00:24,  5.72it/s] 45%|████▍     | 110/247 [00:20<00:23,  5.74it/s] 45%|████▍     | 111/247 [00:20<00:23,  5.70it/s] 45%|████▌     | 112/247 [00:20<00:23,  5.77it/s] 46%|████▌     | 113/247 [00:20<00:23,  5.72it/s] 46%|████▌     | 114/247 [00:20<00:23,  5.74it/s] 47%|████▋     | 115/247 [00:20<00:22,  5.75it/s] 47%|████▋     | 116/247 [00:21<00:22,  5.77it/s] 47%|████▋     | 117/247 [00:21<00:22,  5.68it/s] 48%|████▊     | 118/247 [00:21<00:22,  5.64it/s] 48%|████▊     | 119/247 [00:21<00:22,  5.67it/s] 49%|████▊     | 120/247 [00:21<00:22,  5.71it/s] 49%|████▉     | 121/247 [00:22<00:22,  5.67it/s] 49%|████▉     | 122/247 [00:22<00:22,  5.54it/s] 50%|████▉     | 123/247 [00:22<00:22,  5.61it/s] 50%|█████     | 124/247 [00:22<00:21,  5.66it/s] 51%|█████     | 125/247 [00:22<00:21,  5.70it/s] 51%|█████     | 126/247 [00:22<00:21,  5.73it/s] 51%|█████▏    | 127/247 [00:23<00:20,  5.76it/s] 52%|█████▏    | 128/247 [00:23<00:20,  5.77it/s] 52%|█████▏    | 129/247 [00:23<00:20,  5.70it/s] 53%|█████▎    | 130/247 [00:23<00:20,  5.75it/s] 53%|█████▎    | 131/247 [00:23<00:20,  5.72it/s] 53%|█████▎    | 132/247 [00:23<00:20,  5.74it/s] 54%|█████▍    | 133/247 [00:24<00:19,  5.77it/s] 54%|█████▍    | 134/247 [00:24<00:19,  5.78it/s] 55%|█████▍    | 135/247 [00:24<00:19,  5.79it/s] 55%|█████▌    | 136/247 [00:24<00:19,  5.80it/s] 55%|█████▌    | 137/247 [00:24<00:18,  5.81it/s] 56%|█████▌    | 138/247 [00:24<00:18,  5.79it/s] 56%|█████▋    | 139/247 [00:25<00:18,  5.74it/s] 57%|█████▋    | 140/247 [00:25<00:18,  5.75it/s] 57%|█████▋    | 141/247 [00:25<00:18,  5.75it/s] 57%|█████▋    | 142/247 [00:25<00:18,  5.73it/s] 58%|█████▊    | 143/247 [00:25<00:18,  5.74it/s] 58%|█████▊    | 144/247 [00:26<00:18,  5.62it/s] 59%|█████▊    | 145/247 [00:26<00:17,  5.67it/s] 59%|█████▉    | 146/247 [00:26<00:17,  5.67it/s] 60%|█████▉    | 147/247 [00:26<00:17,  5.69it/s] 60%|█████▉    | 148/247 [00:26<00:17,  5.66it/s] 60%|██████    | 149/247 [00:26<00:17,  5.68it/s] 61%|██████    | 150/247 [00:27<00:17,  5.64it/s] 61%|██████    | 151/247 [00:27<00:17,  5.50it/s] 62%|██████▏   | 152/247 [00:27<00:17,  5.58it/s] 62%|██████▏   | 153/247 [00:27<00:16,  5.65it/s] 62%|██████▏   | 154/247 [00:27<00:16,  5.63it/s] 63%|██████▎   | 155/247 [00:27<00:16,  5.70it/s] 63%|██████▎   | 156/247 [00:28<00:15,  5.70it/s] 64%|██████▎   | 157/247 [00:28<00:15,  5.72it/s] 64%|██████▍   | 158/247 [00:28<00:15,  5.74it/s] 64%|██████▍   | 159/247 [00:28<00:15,  5.75it/s] 65%|██████▍   | 160/247 [00:28<00:15,  5.79it/s] 65%|██████▌   | 161/247 [00:29<00:14,  5.80it/s] 66%|██████▌   | 162/247 [00:29<00:14,  5.80it/s] 66%|██████▌   | 163/247 [00:29<00:14,  5.78it/s] 66%|██████▋   | 164/247 [00:29<00:14,  5.79it/s] 67%|██████▋   | 165/247 [00:29<00:14,  5.79it/s] 67%|██████▋   | 166/247 [00:29<00:14,  5.74it/s] 68%|██████▊   | 167/247 [00:30<00:13,  5.75it/s] 68%|██████▊   | 168/247 [00:30<00:13,  5.75it/s] 68%|██████▊   | 169/247 [00:30<00:13,  5.79it/s] 69%|██████▉   | 170/247 [00:30<00:13,  5.80it/s] 69%|██████▉   | 171/247 [00:30<00:13,  5.76it/s] 70%|██████▉   | 172/247 [00:30<00:13,  5.77it/s] 70%|███████   | 173/247 [00:31<00:12,  5.78it/s] 70%|███████   | 174/247 [00:31<00:12,  5.78it/s] 71%|███████   | 175/247 [00:31<00:12,  5.78it/s] 71%|███████▏  | 176/247 [00:31<00:12,  5.78it/s] 72%|███████▏  | 177/247 [00:31<00:12,  5.79it/s] 72%|███████▏  | 178/247 [00:31<00:11,  5.76it/s] 72%|███████▏  | 179/247 [00:32<00:11,  5.75it/s] 73%|███████▎  | 180/247 [00:32<00:11,  5.69it/s] 73%|███████▎  | 181/247 [00:32<00:11,  5.74it/s] 74%|███████▎  | 182/247 [00:32<00:11,  5.75it/s] 74%|███████▍  | 183/247 [00:32<00:11,  5.79it/s] 74%|███████▍  | 184/247 [00:33<00:10,  5.79it/s] 75%|███████▍  | 185/247 [00:33<00:10,  5.78it/s] 75%|███████▌  | 186/247 [00:33<00:10,  5.79it/s] 76%|███████▌  | 187/247 [00:33<00:10,  5.79it/s] 76%|███████▌  | 188/247 [00:33<00:10,  5.79it/s] 77%|███████▋  | 189/247 [00:33<00:09,  5.80it/s] 77%|███████▋  | 190/247 [00:34<00:09,  5.82it/s] 77%|███████▋  | 191/247 [00:34<00:09,  5.83it/s] 78%|███████▊  | 192/247 [00:34<00:09,  5.79it/s] 78%|███████▊  | 193/247 [00:34<00:09,  5.80it/s] 79%|███████▊  | 194/247 [00:34<00:09,  5.83it/s] 79%|███████▉  | 195/247 [00:34<00:08,  5.85it/s] 79%|███████▉  | 196/247 [00:35<00:08,  5.85it/s] 80%|███████▉  | 197/247 [00:35<00:08,  5.88it/s] 80%|████████  | 198/247 [00:35<00:08,  5.87it/s] 81%|████████  | 199/247 [00:35<00:08,  5.88it/s] 81%|████████  | 200/247 [00:35<00:08,  5.85it/s] 81%|████████▏ | 201/247 [00:35<00:07,  5.87it/s] 82%|████████▏ | 202/247 [00:36<00:07,  5.87it/s] 82%|████████▏ | 203/247 [00:36<00:07,  5.78it/s] 83%|████████▎ | 204/247 [00:36<00:07,  5.80it/s] 83%|████████▎ | 205/247 [00:36<00:07,  5.82it/s] 83%|████████▎ | 206/247 [00:36<00:07,  5.82it/s] 84%|████████▍ | 207/247 [00:36<00:06,  5.80it/s] 84%|████████▍ | 208/247 [00:37<00:06,  5.80it/s] 85%|████████▍ | 209/247 [00:37<00:06,  5.80it/s] 85%|████████▌ | 210/247 [00:37<00:06,  5.83it/s] 85%|████████▌ | 211/247 [00:37<00:06,  5.85it/s] 86%|████████▌ | 212/247 [00:37<00:06,  5.81it/s] 86%|████████▌ | 213/247 [00:37<00:05,  5.82it/s] 87%|████████▋ | 214/247 [00:38<00:05,  5.84it/s] 87%|████████▋ | 215/247 [00:38<00:05,  5.84it/s] 87%|████████▋ | 216/247 [00:38<00:05,  5.84it/s] 88%|████████▊ | 217/247 [00:38<00:05,  5.86it/s] 88%|████████▊ | 218/247 [00:38<00:04,  5.87it/s] 89%|████████▊ | 219/247 [00:39<00:04,  5.88it/s] 89%|████████▉ | 220/247 [00:39<00:04,  5.88it/s] 89%|████████▉ | 221/247 [00:39<00:04,  5.85it/s] 90%|████████▉ | 222/247 [00:39<00:04,  5.80it/s] 90%|█████████ | 223/247 [00:39<00:04,  5.83it/s] 91%|█████████ | 224/247 [00:39<00:03,  5.78it/s] 91%|█████████ | 225/247 [00:40<00:03,  5.72it/s] 91%|█████████▏| 226/247 [00:40<00:03,  5.75it/s] 92%|█████████▏| 227/247 [00:40<00:03,  5.80it/s] 92%|█████████▏| 228/247 [00:40<00:03,  5.82it/s] 93%|█████████▎| 229/247 [00:40<00:03,  5.75it/s] 93%|█████████▎| 230/247 [00:40<00:02,  5.72it/s] 94%|█████████▎| 231/247 [00:41<00:02,  5.79it/s] 94%|█████████▍| 232/247 [00:41<00:02,  5.64it/s] 94%|█████████▍| 233/247 [00:41<00:02,  5.69it/s] 95%|█████████▍| 234/247 [00:41<00:02,  5.72it/s] 95%|█████████▌| 235/247 [00:41<00:02,  5.72it/s] 96%|█████████▌| 236/247 [00:41<00:01,  5.76it/s] 96%|█████████▌| 237/247 [00:42<00:01,  5.78it/s] 96%|█████████▋| 238/247 [00:42<00:01,  5.77it/s] 97%|█████████▋| 239/247 [00:42<00:01,  5.80it/s] 97%|█████████▋| 240/247 [00:42<00:01,  5.80it/s] 98%|█████████▊| 241/247 [00:42<00:01,  5.78it/s] 98%|█████████▊| 242/247 [00:43<00:00,  5.74it/s] 98%|█████████▊| 243/247 [00:43<00:00,  5.76it/s] 99%|█████████▉| 244/247 [00:43<00:00,  5.75it/s] 99%|█████████▉| 245/247 [00:43<00:00,  5.78it/s]100%|█████████▉| 246/247 [00:43<00:00,  5.78it/s]100%|██████████| 247/247 [00:43<00:00,  5.83it/s]
  0%|          | 0/250 [00:00<?, ?it/s][A
  2%|▏         | 4/250 [00:00<00:09, 26.81it/s][A
  3%|▎         | 7/250 [00:00<00:10, 23.50it/s][A
  4%|▍         | 10/250 [00:00<00:10, 21.87it/s][A
  5%|▌         | 13/250 [00:01<00:27,  8.55it/s][A
  6%|▌         | 15/250 [00:01<00:38,  6.08it/s][A
  7%|▋         | 17/250 [00:02<00:46,  4.98it/s][A
  7%|▋         | 18/250 [00:02<01:00,  3.81it/s][A
  8%|▊         | 19/250 [00:03<01:04,  3.59it/s][A
  8%|▊         | 20/250 [00:03<01:09,  3.33it/s][A
  8%|▊         | 21/250 [00:04<01:13,  3.10it/s][A
  9%|▉         | 22/250 [00:04<01:19,  2.87it/s][A
  9%|▉         | 23/250 [00:04<01:23,  2.70it/s][A
 10%|▉         | 24/250 [00:05<01:28,  2.55it/s][A
 10%|█         | 25/250 [00:05<01:33,  2.42it/s][ATraceback (most recent call last):
  File "/root/final/code/translation_trainer_2.py", line 371, in <module>
    main()
  File "/root/final/code/translation_trainer_2.py", line 360, in main
    scale_law_for_qwen_model(datasets)
  File "/root/final/code/translation_trainer_2.py", line 339, in scale_law_for_qwen_model
    train_qwen_model(datasets, model_name="Qwen/Qwen2.5-0.5B", size=0.001, use_cache=True)
  File "/root/final/code/translation_trainer_2.py", line 335, in train_qwen_model
    qwen_trainer.train(small_datasets, output_dir=output_dir, epochs=1, batch_size=2)
  File "/root/final/code/translation_trainer_2.py", line 252, in train
    trainer.train()
  File "/root/miniconda3/lib/python3.12/site-packages/transformers/trainer.py", line 2207, in train
    return inner_training_loop(
           ^^^^^^^^^^^^^^^^^^^^
  File "/root/miniconda3/lib/python3.12/site-packages/transformers/trainer.py", line 2658, in _inner_training_loop
    self._maybe_log_save_evaluate(
  File "/root/miniconda3/lib/python3.12/site-packages/transformers/trainer.py", line 3097, in _maybe_log_save_evaluate
    metrics = self._evaluate(trial, ignore_keys_for_eval)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/miniconda3/lib/python3.12/site-packages/transformers/trainer.py", line 3046, in _evaluate
    metrics = self.evaluate(ignore_keys=ignore_keys_for_eval)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/miniconda3/lib/python3.12/site-packages/transformers/trainer.py", line 4200, in evaluate
    output = eval_loop(
             ^^^^^^^^^^
  File "/root/miniconda3/lib/python3.12/site-packages/transformers/trainer.py", line 4422, in evaluation_loop
    all_preds.add(logits)
  File "/root/miniconda3/lib/python3.12/site-packages/transformers/trainer_pt_utils.py", line 317, in add
    self.tensors = nested_concat(self.tensors, tensors, padding_index=self.padding_index)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/miniconda3/lib/python3.12/site-packages/transformers/trainer_pt_utils.py", line 131, in nested_concat
    return torch_pad_and_concatenate(tensors, new_tensors, padding_index=padding_index)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/miniconda3/lib/python3.12/site-packages/transformers/trainer_pt_utils.py", line 89, in torch_pad_and_concatenate
    return torch.cat((tensor1, tensor2), dim=0)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
torch.OutOfMemoryError: CUDA out of memory. Tried to allocate 15.07 GiB. GPU 0 has a total capacity of 39.38 GiB of which 15.07 GiB is free. Process 335158 has 24.30 GiB memory in use. Of the allocated memory 17.86 GiB is allocated by PyTorch, and 5.94 GiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
100%|██████████| 247/247 [01:03<00:00,  3.91it/s]

                                                [A